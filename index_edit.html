<html>
<style>
  a:hover{font-weight:700;color:#000}#body_preview{margin:0;font-size:14px;font-family:"Helvetica Neue",Helvetica}
   .node circle{cursor:pointer;stroke-width:1.5px}.node text{font-size:11px}
    path.link{fill:none;stroke:#ccc;stroke-width:1.5px}
  td.sliderClass{width:120px;}
  .ui-multiselect{padding:2px 0 2px 4px;text-align:left}.ui-multiselect span.ui-icon{float:right}.ui-multiselect-single .ui-multiselect-checkboxes input{position:absolute!important;top:auto!important;left:-9999px}.ui-multiselect-single .ui-multiselect-checkboxes label{padding:5px!important}.ui-multiselect-header{margin-bottom:3px;padding:3px 0 3px 4px}.ui-multiselect-header ul{font-size:.9em}.ui-multiselect-header ul li{float:left;padding:0 10px 0 0}.ui-multiselect-header a{text-decoration:none}.ui-multiselect-header a:hover{text-decoration:underline}.ui-multiselect-header span.ui-icon{float:left}.ui-multiselect-header li.ui-multiselect-close{float:right;text-align:right;padding-right:0}.ui-multiselect-menu{display:none;padding:3px;position:absolute;z-index:10000;text-align:left}.ui-multiselect-checkboxes{position:relative;overflow-y:auto}.ui-multiselect-checkboxes label{cursor:default;display:block;border:1px solid transparent;padding:3px 1px}.ui-multiselect-checkboxes label input{position:relative;top:1px}.ui-multiselect-checkboxes li{clear:both;font-size:.9em;padding-right:3px}.ui-multiselect-checkboxes li.ui-multiselect-optgroup-label{text-align:center;font-weight:700;border-bottom:1px solid}.ui-multiselect-checkboxes li.ui-multiselect-optgroup-label a{display:block;padding:3px;margin:1px 0;text-decoration:none}* html .ui-multiselect-checkboxes label{border:none}
 </style>
 <link rel="stylesheet" type="text/css" href="../FederalBudget_JqueryUI/themes/base/jquery-ui.css">

<table id='dataGroup_preview'></table>
		<div id="toolTip_preview" class="tooltip" style="opacity:0;">
          <div id="head" class="header"></div>
          <div id="header1" class="header1"></div>
          <div id="header2" class="header2"></div>
          <div id="toolAppend" style="position:absolute; left:10px"></div>
		  <div  class="tooltipTail"></div>
		</div>
<div id='body_preview'></div>
<script src="d3.v3.min.js" ></script>
<script src="underscore.js" ></script>
<script src="underscore.string-2.3.0.js" ></script>
<script src="../FederalBudget_JqueryUI/jquery-1.7.1.js" ></script>
<script src="../FederalBudget_JqueryUI/ui/jquery-ui.js" ></script>
<script src="../FederalBudget_JqueryUI/multiSelectCustom.js" ></script>
 <script src="federalBudget.js" charset="UTF-8"></script>

<script type="text/javascript"> 
if (!String.prototype.contains) {
  String.prototype.contains = function() {'use strict';
    return String.prototype.indexOf.apply(this, arguments) !== -1;
  };
}
//normal
//var view={"jsonClass":"View","elxType":"View","vtype":"bundle","state":"visible","isContainer":false,"position":{"jsonClass":"Position","elxType":"Position","height":"420","width":"670","zIndex":"auto","x":35,"y":25},"data":{"jsonClass":"DataEmbedded","datasource":{"jsonClass":"DataSource","name":"initData","stype":"Data","desc":"default data","schema":{"jsonClass":"Schema","caseSensitive":false,"columns":[{"jsonClass":"SchemaColumn","name":"Department","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Team","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee Description","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Salary","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Profit","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Sales Target","dtype":"Double","attrs":[]}]},"data":{"jsonClass":"DataRecords","records":[{"jsonClass":"Record","fields":[{"jsonClass":"Field","value":"Sales"},{"jsonClass":"Field","value":"Team A"},{"jsonClass":"Field","value":"Employee A"},{"jsonClass":"Field","value":"Employee A Description"},{"jsonClass":"Field","value":"2000"},{"jsonClass":"Field","value":"13000"},{"jsonClass":"Field","value":"9000"}]}]}},"hint":"directive-data-array","directive":"ZnVuY3Rpb24gZGF0YSgpew0KdmFyIGNUb2dnbGVUeXBlPXZpZXcudHlwZWluZm8uZGF0YS5jVG9nZ2xlVHlwZUNvbDsNCnZhciBjRGVzY3JpcHRpb249dmlldy50eXBlaW5mby5kYXRhLmNEZXNjcmlwdGlvbkNvbDsNCiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOw0KICAJdmFyIGs9dmlldy50eXBlaW5mby5kYXRhLmtleXM7DQoNCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsNCiBpZihjVG9nZ2xlVHlwZVswXS5uYW1lICE9bnVsbCAmJiB2aWV3LnR5cGVpbmZvLmNUb2dnbGVLZXkhPSdkZWZhdWx0JykNCiB7a2V5cy5wdXNoKGNUb2dnbGVUeXBlWzBdLm5hbWUpO30NCiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpDQoge2tleXMucHVzaChjRGVzY3JpcHRpb25bMF0ubmFtZSk7fQ0KICB0LmZvckVhY2goZnVuY3Rpb24oZCxpKSB7DQogIGNvbHVtbnMucHVzaChkLm5hbWUpOw0KICAgIG9wZXJhdGlvbnMucHVzaChkLm9wKTsNCiAgfSkNCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgew0KICAgIGtleXMucHVzaChkLm5hbWUpO30pDQogICByZXR1cm4gcm93cy5ncm91cEJ5KGtleXMsY29sdW1ucywgb3BlcmF0aW9ucyk7DQp9DQpkYXRhKCk7"},"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{"name":"Department"}],"cDescriptionCol":[{"name":"Employee Description"}],"keys":[{"name":"Team","id":"|"},{"name":"Employee","id":"|"}],"operable":{"values":[{"id":"Salary.1","name":"Salary","op":"sum"},{"id":"Profit.2","name":"Profit","op":"sum"},{"id":"Sales Target.3","name":"Sales Target","op":"sum"}]}},"formatClassKey":"","cToggleKey":"default","cDescriptionKey":"default","formatClassCast":"","formatPrefixCast":"","nestArr":"Team,Employee","width":"800","height":"500","marginB":"0","marginT":"10","marginL":"170","marginR":"100"},"id":"preview","name":"Preview"};
 //formatClassCast, cDescriptionDefault,cToggleDefault
 var view={"jsonClass":"View","elxType":"View","vtype":"bundle","state":"visible","isContainer":false,"position":{"jsonClass":"Position","elxType":"Position","height":"420","width":"670","zIndex":"auto","x":35,"y":25},"data":{"jsonClass":"DataEmbedded","datasource":{"jsonClass":"DataSource","name":"initData","stype":"Data","desc":"default data","schema":{"jsonClass":"Schema","caseSensitive":false,"columns":[{"jsonClass":"SchemaColumn","name":"Department","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Team","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee Description","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Salary","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Profit","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Sales Target","dtype":"Double","attrs":[]}]},"data":{"jsonClass":"DataRecords","records":[{"jsonClass":"Record","fields":[{"jsonClass":"Field","value":"Sales"},{"jsonClass":"Field","value":"Team A"},{"jsonClass":"Field","value":"Employee A"},{"jsonClass":"Field","value":"Employee A Description"},{"jsonClass":"Field","value":"2000"},{"jsonClass":"Field","value":"13000"},{"jsonClass":"Field","value":"9000"}]}]}},"hint":"directive-data-array","directive":"ZnVuY3Rpb24gZGF0YSgpew0KdmFyIGNUb2dnbGVUeXBlPXZpZXcudHlwZWluZm8uZGF0YS5jVG9nZ2xlVHlwZUNvbDsNCnZhciBjRGVzY3JpcHRpb249dmlldy50eXBlaW5mby5kYXRhLmNEZXNjcmlwdGlvbkNvbDsNCiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOw0KICAJdmFyIGs9dmlldy50eXBlaW5mby5kYXRhLmtleXM7DQoNCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsNCiBpZihjVG9nZ2xlVHlwZVswXS5uYW1lICE9bnVsbCAmJiB2aWV3LnR5cGVpbmZvLmNUb2dnbGVLZXkhPSdkZWZhdWx0JykNCiB7a2V5cy5wdXNoKGNUb2dnbGVUeXBlWzBdLm5hbWUpO30NCiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpDQoge2tleXMucHVzaChjRGVzY3JpcHRpb25bMF0ubmFtZSk7fQ0KICB0LmZvckVhY2goZnVuY3Rpb24oZCxpKSB7DQogIGNvbHVtbnMucHVzaChkLm5hbWUpOw0KICAgIG9wZXJhdGlvbnMucHVzaChkLm9wKTsNCiAgfSkNCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgew0KICAgIGtleXMucHVzaChkLm5hbWUpO30pDQogICByZXR1cm4gcm93cy5ncm91cEJ5KGtleXMsY29sdW1ucywgb3BlcmF0aW9ucyk7DQp9DQpkYXRhKCk7"},"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{"name":"Department"}],"cDescriptionCol":[{"name":"Employee Description"}],"keys":[{"name":"Team","id":"|"},{"name":"Employee","id":"|"}],"operable":{"values":[{"id":"Salary.1","name":"Salary","op":"sum"},{"id":"Profit.2","name":"Profit","op":"sum"},{"id":"Sales Target.3","name":"Sales Target","op":"sum"}]}},"formatClassKey":"formatClassCast","cToggleKey":"default","cDescriptionKey":"default","formatClassCast":"formatClass = { '1': {'cToggleAccept': 'All','formatValueByCategory': function(arr) {return sum(arr);}}}","formatPrefixCast":"","nestArr":"Team,Employee","width":"800","height":"500","marginB":"0","marginT":"10","marginL":"170","marginR":"100"},"id":"preview","name":"Preview"};
var view={"jsonClass":"View","elxType":"View","id":"preview","name":"View-1","state":"visible","vtype":"bundle","isContainer":false,"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{}],"cDescriptionCol":[{}],"keys":[{"name":"ds_1b_employee.SalesTeam","id":"|"},{"name":"ds_1b_employee.staff_code","id":"|"}],"operable":{"values":[{"id":"Inventory.1","name":"ds_1b_employee.Tonnage","op":"sum"},{"id":"Sales.1","name":"ds_1b_employee.Sales","op":"sum"},{"id":"Gross_Profit.1","name":"ds_1b_employee.Gross_Profit","op":"sum"},{"id":"Acount_Receivable.1","name":"ds_1b_employee.Account_Receivables","op":"sum"}]}},"formatClassKey":"formatClassCast","cToggleKey":"default","cDescriptionKey":"default","formatClassCast":"formatClass = { '1': {'cToggleAccept': 'All','formatValue': function(val) {return d3.round(val,2);}}}","formatPrefixCast":"","nestArr":"Team,Employee","width":"680","height":"750","marginB":"0","marginT":"30","marginL":"170","marginR":"20","frameWidth":"670","frameHeight":"420","navBarMinWidth":"180"},"position":{"jsonClass":"Position","elxType":"Position","height":745,"width":788,"x":63,"y":133,"zIndex":"auto"},"data":{"jsonClass":"DataEmbedded","fields":[{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"Account_Receivables","label":"","sort":"","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"Sales","label":"","sort":"","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"Gross_Profit","label":"","sort":"","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"SalesTeam","label":"","sort":"","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"Tonnage","label":"","sort":"","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"ds_1b_employee","column":"staff_code","label":"","sort":"","align":"none","operation":"none"}],"hint":"directive-data-array","directive":"ZnVuY3Rpb24gZGF0YSgpewp2YXIgY1RvZ2dsZVR5cGU9dmlldy50eXBlaW5mby5kYXRhLmNUb2dnbGVUeXBlQ29sOwp2YXIgY0Rlc2NyaXB0aW9uPXZpZXcudHlwZWluZm8uZGF0YS5jRGVzY3JpcHRpb25Db2w7CiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOwogIAl2YXIgaz12aWV3LnR5cGVpbmZvLmRhdGEua2V5czsKCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsKIGlmKGNUb2dnbGVUeXBlWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY1RvZ2dsZUtleSE9J2RlZmF1bHQnKQoge2tleXMucHVzaChjVG9nZ2xlVHlwZVswXS5uYW1lKTt9CiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpCiB7a2V5cy5wdXNoKGNEZXNjcmlwdGlvblswXS5uYW1lKTt9CiAgdC5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogIGNvbHVtbnMucHVzaChkLm5hbWUpOwogICAgb3BlcmF0aW9ucy5wdXNoKGQub3ApOwogIH0pCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogICAga2V5cy5wdXNoKGQubmFtZSk7fSkKICAgcmV0dXJuIHJvd3MuZ3JvdXBCeShrZXlzLGNvbHVtbnMsIG9wZXJhdGlvbnMpOwp9CmRhdGEoKTs="},"isPreview":false,"originalId":"v-95"};
 
 //cDescriptionEnabled, cToggleDefault
 // var view= {"id":"preview","name":"View-1","vtype":"bundle","jsonClass":"View","elxType":"View","state":"visible","isContainer":false,"position":{"jsonClass":"Position","elxType":"Position","height":420,"width":670,"zIndex":"auto","x":35.46665954589844,"y":250.8333282470703},"data":{"jsonClass":"DataEmbedded","fields":[{"jsonClass":"FieldInfo","table":"1b_ar","column":"Ar","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Date","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Salesperson","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Team","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Total","label":"","sort":"none","align":"none","operation":"none"}],"directive":"ZnVuY3Rpb24gZGF0YSgpewp2YXIgY1RvZ2dsZVR5cGU9dmlldy50eXBlaW5mby5kYXRhLmNUb2dnbGVUeXBlQ29sOwp2YXIgY0Rlc2NyaXB0aW9uPXZpZXcudHlwZWluZm8uZGF0YS5jRGVzY3JpcHRpb25Db2w7CiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOwogIAl2YXIgaz12aWV3LnR5cGVpbmZvLmRhdGEua2V5czsKCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsKIGlmKGNUb2dnbGVUeXBlWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY1RvZ2dsZUtleSE9J2RlZmF1bHQnKQoge2tleXMucHVzaChjVG9nZ2xlVHlwZVswXS5uYW1lKTt9CiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpCiB7a2V5cy5wdXNoKGNEZXNjcmlwdGlvblswXS5uYW1lKTt9CiAgdC5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogIGNvbHVtbnMucHVzaChkLm5hbWUpOwogICAgb3BlcmF0aW9ucy5wdXNoKGQub3ApOwogIH0pCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogICAga2V5cy5wdXNoKGQubmFtZSk7fSkKICAgcmV0dXJuIHJvd3MuZ3JvdXBCeShrZXlzLGNvbHVtbnMsIG9wZXJhdGlvbnMpOwp9CmRhdGEoKTs=","hint":"directive-data-array"},"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{}],"cDescriptionCol":[{"name":"1b_ar.Ar"}],"keys":[{"name":"1b_ar.Team"},{"name":"1b_ar.Salesperson"}],"operable":{"values":[{"id":"Total.1","name":"1b_ar.Total","op":"sum"}]}},"formatClassKey":"formatClassCast","cToggleKey":"default","cDescriptionKey":"cDescriptionEnabled","formatClassCast":"formatClass = { '1': {'cToggleAccept': 'All','formatValueByCategory': function(arr) {return sum(arr);}}}","formatPrefixCast":"","nestArr":"Team,Employee","width":"680","height":"750","marginB":"0","marginT":"30","marginL":"170","marginR":"20","frameWidth":"670","frameHeight":"420","navBarMinWidth":"180"},"isPreview":false,"originalId":"v-31"};
 //cDescriptionEnabled, cToggleEnabled
 //var view={"jsonClass":"View","elxType":"View","vtype":"bundle","state":"visible","isContainer":false,"position":{"jsonClass":"Position","elxType":"Position","height":"420","width":"670","zIndex":"auto","x":35,"y":25},"data":{"jsonClass":"DataEmbedded","datasource":{"jsonClass":"DataSource","name":"initData","stype":"Data","desc":"default data","schema":{"jsonClass":"Schema","caseSensitive":false,"columns":[{"jsonClass":"SchemaColumn","name":"Department","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Team","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Employee Description","dtype":"String","attrs":[]},{"jsonClass":"SchemaColumn","name":"Salary","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Profit","dtype":"Double","attrs":[]},{"jsonClass":"SchemaColumn","name":"Sales Target","dtype":"Double","attrs":[]}]},"data":{"jsonClass":"DataRecords","records":[{"jsonClass":"Record","fields":[{"jsonClass":"Field","value":"Sales"},{"jsonClass":"Field","value":"Team A"},{"jsonClass":"Field","value":"Employee A"},{"jsonClass":"Field","value":"Employee A Description"},{"jsonClass":"Field","value":"2000"},{"jsonClass":"Field","value":"13000"},{"jsonClass":"Field","value":"9000"}]}]}},"hint":"directive-data-array","directive":"ZnVuY3Rpb24gZGF0YSgpew0KdmFyIGNUb2dnbGVUeXBlPXZpZXcudHlwZWluZm8uZGF0YS5jVG9nZ2xlVHlwZUNvbDsNCnZhciBjRGVzY3JpcHRpb249dmlldy50eXBlaW5mby5kYXRhLmNEZXNjcmlwdGlvbkNvbDsNCiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOw0KICAJdmFyIGs9dmlldy50eXBlaW5mby5kYXRhLmtleXM7DQoNCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsNCiBpZihjVG9nZ2xlVHlwZVswXS5uYW1lICE9bnVsbCAmJiB2aWV3LnR5cGVpbmZvLmNUb2dnbGVLZXkhPSdkZWZhdWx0JykNCiB7a2V5cy5wdXNoKGNUb2dnbGVUeXBlWzBdLm5hbWUpO30NCiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpDQoge2tleXMucHVzaChjRGVzY3JpcHRpb25bMF0ubmFtZSk7fQ0KICB0LmZvckVhY2goZnVuY3Rpb24oZCxpKSB7DQogIGNvbHVtbnMucHVzaChkLm5hbWUpOw0KICAgIG9wZXJhdGlvbnMucHVzaChkLm9wKTsNCiAgfSkNCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgew0KICAgIGtleXMucHVzaChkLm5hbWUpO30pDQogICByZXR1cm4gcm93cy5ncm91cEJ5KGtleXMsY29sdW1ucywgb3BlcmF0aW9ucyk7DQp9DQpkYXRhKCk7"},"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{"name":"Department"}],"cDescriptionCol":[{"name":"Employee Description"}],"keys":[{"name":"Team","id":"|"},{"name":"Employee","id":"|"}],"operable":{"values":[{"id":"Salary.1","name":"Salary","op":"sum"},{"id":"Profit.2","name":"Profit","op":"sum"},{"id":"Sales Target.3","name":"Sales Target","op":"sum"}]}},"formatClassKey":"formatClassCast","cToggleKey":"cToggleEnabled","cDescriptionKey":"cDescriptionEnabled","formatClassCast":"formatClass = { '1': {'cToggleAccept': 'All','formatValueByCategory': function(arr) {return sum(arr);}}}","formatPrefixCast":"","nestArr":"Team,Employee","width":"800","height":"500","marginB":"0","marginT":"10","marginL":"170","marginR":"100"},"id":"preview","name":"Preview"};
 //cToggleEnabled,cDescriptionDefault
 //var view={"jsonClass":"View","elxType":"View","id":"preview","name":"View-1","state":"visible","vtype":"bundle","isContainer":false,"typeinfo":{"jsonClass":"Bundle","type":"FederalBudget2","data":{"cToggleTypeCol":[{"name":"1b_ar.Ar"}],"cDescriptionCol":[{}],"keys":[{"name":"1b_ar.Team"},{"name":"1b_ar.Salesperson"}],"operable":{"values":[{"id":"Total.1","name":"1b_ar.Total","op":"sum"}]}},"formatClassKey":"formatClassCast","cToggleKey":"cToggleEnabled","cDescriptionKey":"default","formatClassCast":"formatClass = { '1': {'cToggleAccept': 'All','formatValueByCategory': function(arr) {return d3.sum(arr);}}}","formatPrefixCast":"","nestArr":"Team,Employee","width":"680","height":"750","marginB":"0","marginT":"30","marginL":"170","marginR":"20","frameWidth":"670","frameHeight":"420","navBarMinWidth":"180"},"position":{"jsonClass":"Position","elxType":"Position","height":420,"width":670,"x":35,"y":250,"zIndex":"auto"},"data":{"jsonClass":"DataEmbedded","fields":[{"jsonClass":"FieldInfo","table":"1b_ar","column":"Ar","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Date","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Salesperson","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Team","label":"","sort":"none","align":"none","operation":"none"},{"jsonClass":"FieldInfo","table":"1b_ar","column":"Total","label":"","sort":"none","align":"none","operation":"none"}],"directive":"ZnVuY3Rpb24gZGF0YSgpewp2YXIgY1RvZ2dsZVR5cGU9dmlldy50eXBlaW5mby5kYXRhLmNUb2dnbGVUeXBlQ29sOwp2YXIgY0Rlc2NyaXB0aW9uPXZpZXcudHlwZWluZm8uZGF0YS5jRGVzY3JpcHRpb25Db2w7CiAgICB2YXIgdD12aWV3LnR5cGVpbmZvLmRhdGEub3BlcmFibGUudmFsdWVzOwogIAl2YXIgaz12aWV3LnR5cGVpbmZvLmRhdGEua2V5czsKCiAgdmFyIGNvbHVtbnM9W107IHZhciBvcGVyYXRpb25zPVtdOyB2YXIga2V5cz1bXTsKIGlmKGNUb2dnbGVUeXBlWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY1RvZ2dsZUtleSE9J2RlZmF1bHQnKQoge2tleXMucHVzaChjVG9nZ2xlVHlwZVswXS5uYW1lKTt9CiAgaWYoY0Rlc2NyaXB0aW9uWzBdLm5hbWUgIT1udWxsICYmIHZpZXcudHlwZWluZm8uY0Rlc2NyaXB0aW9uS2V5IT0nZGVmYXVsdCcpCiB7a2V5cy5wdXNoKGNEZXNjcmlwdGlvblswXS5uYW1lKTt9CiAgdC5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogIGNvbHVtbnMucHVzaChkLm5hbWUpOwogICAgb3BlcmF0aW9ucy5wdXNoKGQub3ApOwogIH0pCiAgay5mb3JFYWNoKGZ1bmN0aW9uKGQsaSkgewogICAga2V5cy5wdXNoKGQubmFtZSk7fSkKICAgcmV0dXJuIHJvd3MuZ3JvdXBCeShrZXlzLGNvbHVtbnMsIG9wZXJhdGlvbnMpOwp9CmRhdGEoKTs=","hint":"directive-data-array"},"isPreview":false,"originalId":"v-31"};
  
 var viewId = view.id;
 var cfgoptions = view.typeinfo;
 var f = view.typeinfo.data;
 var margin = [cfgoptions.marginB, cfgoptions.marginL, cfgoptions.marginT, cfgoptions.marginR],
     width = cfgoptions.width - margin[1] - margin[3],
     height = cfgoptions.height - margin[0] - margin[2];
 var formatClassKey = cfgoptions.formatClassKey,
     formatClassCast = cfgoptions.formatClassCast,
     formatPrefixCast = cfgoptions.formatPrefixCast;

var initializedCMap = {};


 var safeRead;var cutTableName; var getArr;
 var cTypeClassOutput;
  var  extendArr, arrToHex1;
  var hexToModel1,processCFields,modelToHex,groupByFn,chartPreGen,initializeToolTip;

  debugFn();

 // get Data
 if (view.data.jsonClass === "DataEmbedded") {
     rawdata = [
         ["Sales", "John 1", "A", "John", 2000, 30, 52],
         ["Sales", "John 1", "A", "John", 2000, 30, 52],
         ["Sales", "John 1", "A", "John", 2000, 30, 52],
         ["Sales", "Gary 1", "A", "Gary", 3000, 30, 52],
         ["Sales", "Gary 1", "A", "Gary", 2500, 90, 41],
         ["Sales", "Jim 1", "B", "Jim", 2000, 30, 40],
         ["Sales", "Jim 1", "B", "Jim", 1790, 30, 40],
         ["Sales", "Tooi 1", "B", "Tooi", 4000, 58, 79],
         ["Driver", "Fope 1", "J", "Fope", 1000, 90, 0],
         ["Driver", "Fope 1", "J", "Fope", 1000, 90, 0],
         ["Driver", "Fope 1", "J", "Fope", 1000, 90, 0],
         ["Driver", "Goot 1", "J", "Goot", 1000, 90, 0],
         ["Driver", "Goot 1", "J", "Goot", 1000, 90, 0],
         ["Driver", "Bill 1", "K", "Bill", 1000, 90, 0],
         ["Driver", "Bill 1", "K", "Bill", 1000, 90, 0],
         ["Driver", "Bill 1", "K", "Bill", 1000, 90, 0]
     ];
	 if(view.typeinfo.cDescriptionKey =='default'&& view.typeinfo.cToggleKey=='default'){
rawdata=[["Team A","AL",785.7733,928822.423,178859.4123,0],["Team A","EN",24.1896,24112,3094.48,0],["Team A","JL",39590.4835,40428660.68,4579170.32,0],["Team A","XY",6.9435,2276.5,389.57,0],["Team B","DL",5285.6368,5278067.22,718628.6,0],["Team B","NL",12504.112,12202120.9,1330072.53,0],["Team B","SL",97.0254,102105.3,14350.07,0],["Team B","ST",2489.4816,2474378.84,319836.08,0],["Team B","WS",13199.3366,13573974.15,1630026.15,0],["Team B","XM",22945.5333,22078026.37,1950494.17,0],["Team C","AT",1790.8002,1873825.64,208217.56,0],["Team C","RX",4703.1971,4764684.6,504298.26,0],["Team D","LL",0,279991.76,0,0]];
} 	 if(view.typeinfo.cDescriptionKey =='default'&& view.typeinfo.cToggleKey=='cToggleEnabled'){
rawdata=[
         [ "Sales","A", "John", 2000.3432424, 30, 52],
         [ "Sales","A", "John", 2000, 30, 52],
         [ "Sales","A", "John", 2000, 30, 52],
         [ "Sales","A", "Gary", 3000, 30, 52],
         [ "Sales","A", "Gary", 2500, 90, 41],
         ["Sales", "B", "Jim", 2000, 30, 40],
         [ "Sales","B", "Jim", 1790, 30, 40],
         [ "Sales","B", "Tooi", 4000, 58, 79],
         ["Technical","J", "Fope", 1000, 90, 0],
         ["Technical","J", "Fope", 1000, 90, 0],
         ["Technical", "J", "Fope", 1000, 90, 0],
         ["Technical","J", "Goot", 1000, 90, 0],
         ["Technical","J", "Goot", 1000, 90, 0],
         ["Technical","K", "Bill", 1000, 90, 0],
         ["Technical","K", "Bill", 1000, 90, 0],
         ["Technical","K", "Bill", 1000, 90, 0]
     ];
} 
	 if(view.typeinfo.cDescriptionKey =='cDescriptionEnabled'&& view.typeinfo.cToggleKey=='default'){
rawdata=[
         [ "John 1","A", "John", 2000, 30, 52],
         [ "John 1","A", "John", 2000, 30, 52],
         [ "John 1","A", "John", 2000, 30, 52],
         [ "Gary 1","A", "Gary", 3000, 30, 52],
         [ "Gary 1","A", "Gary", 2500, 90, 41],
         [ "Jim 1", "A","Jim", 2000, 30, 40],
         [ "Jim 1","A", "Jim", 1790, 30, 40],
         [ "Tooi 1","B", "Tooi", 4000, 58, 79],
         ["Fope 1","J", "Fope", 1000, 90, 0],
         ["Fope 1","J", "Fope", 1000, 90, 0],
         [ "Fope 1","J", "Fope", 1000, 90, 0],
         ["Goot 1","J", "Goot", 1000, 90, 0],
         ["Goot 1","J","Goot", 1000, 90, 0],
         ["Bill 1","K", "Bill", 1000, 90, 0],
         ["Bill 1","K", "Bill", 1000, 90, 0],
         ["Bill 1","K", "Bill", 1000, 90, 0]
     ];
} 
	
     var extendedArr = rawdata;
     var reduceCToggleArr = extendedArr;
 } else {
    // rawdata = ${data};
	 rawdata=[23];
     var extendedArr = extendArr(rawdata, f, view);
 }
 console.log("rawdata", JSON.stringify(rawdata));
 //need ** to write a function to deal with Description Column
 console.log("before debugFn");
  console.log("f",f);

console.log("extendedArr",JSON.stringify(extendedArr));
var cFieldsObj={};
  var data1 = arrToHex1(extendedArr, f, view,initializedCMap,cFieldsObj);
 var legendKey = 'lastGroupby_op';
 var formatLegendCast = "";
console.log("data Hex",data1[0]);


 var data2=modelAddCMap(data1,initializedCMap);
 console.log("data AddCMap",JSON.stringify(data2));
 console.log("data AddCMap[0]",data2[0]);
 var data2 = hexToModel1(data2, legendKey, formatLegendCast, view);
 console.log("data2 model",JSON.stringify(data2));
 var nestArr = (cfgoptions.nestArr != null) ? (cfgoptions.nestArr).split(",") : autoDetectNestArr(f, view);
var rootObj={};
var Fselect={};
var ToolTipContainer={};
  var groupCount = 0;
 chartPreGen(data2,rootObj,Fselect);
 var modelYAxisObj={};
 initializeToolTip(f, view, nestArr, groupCount,Fselect,ToolTipContainer,cFieldsObj,modelYAxisObj);
console.log("rootObj",JSON.stringify(rootObj));
console.log("ToolTipContainer",ToolTipContainer);
console.log("Fselect",JSON.stringify(Fselect));
console.log("viewId",viewId);
 //render Chart
  chart = federalChart()
	  .viewId(viewId)
	  .width(width)
	  .height(height)
	  .margin(margin)
	  .formatClass(formatClass)
	  .root(rootObj)
	  .groupCount(groupCount)
	  .modelYAxisObj(modelYAxisObj)
	  .ToolTipContainer(ToolTipContainer)
	  .Fselect(Fselect);
	  
	  	  var formatClass;
 if (formatClassKey == 'formatClassCast') {
     eval(formatClassCast);
	 chart.formatClass(formatClass);
 }
	//  .retDes(retDes)
		;
    d3.select("#body_preview").datum([]).call(chart); 
 
  function debugFn() {

         extendArr = function(data, f, view) {	
             //used when you want to use the same columns in operables
             //obtain uniq columnNames
             var colNameMap = {};
             var uniqColName = [];
             var fieldsArr = getArr(f, 'name', view);
             //if(view.typeinfo.cToggleKey=='default') fieldsArr=_.rest(fieldsArr);
             var n = 0; //n is the index of unextended Arr
             for (var i = 0; i < _.size(fieldsArr); i++) {
                 var colAsProperty = fieldsArr[i];

                 //Obtaining colNameMap
                 if (_.size(uniqColName) == 0) {
                     uniqColName.push(colAsProperty);
                     colNameMap[colAsProperty] = i;
                     n = n + 1;
                 } else {
                     var colAsPropertyArr = [colAsProperty];
                     var intersectArr = _.intersection(colAsPropertyArr, uniqColName);
                     if (_.size(intersectArr) == 0) {
                         uniqColName.push(colAsProperty);
                         colNameMap[colAsProperty] = i;
                         n = n + 1;
                     }
                 }
             }

             //using colNameMap to extendArr
             var extendedArr = [];
             _.each(data, function(k, l) {
                 //eg of k:[asd,34,34]
                 var localArr = [];
                 _.each(fieldsArr, function(o, p) {
                     var indexToChoose = colNameMap[o];
                     localArr.push(k[indexToChoose]);
                 });
                 extendedArr.push(localArr);
             });
             return extendedArr;

         };
   arrToHex1 = function(data, f, view, initializedCMap) {
             var keyLength = f.keys.length;
             var nameArr = getArr(f, 'name', view);
             var opArr = getArr(f, 'op', view);
             var idArr = getArr(f.operable.values, 'id', view);
              cFieldsObj = {
                 'cToggle': {
                     cKey: 'cToggleEnabled',
                     cKeyField: view.typeinfo.cToggleKey,
                     cDataField: view.typeinfo.data.cToggleTypeCol[0].name,
                     cTrue: function(data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,initializedCMap){
					 var newField="";
					 return cTypeClassOutput['majority'](data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,newField, initializedCMap);
					 },
					 cDefault: function(data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,initializedCMap){
					 var newField="";
					 return cTypeClassOutput['cMapNotDefined'](data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,newField, initializedCMap);
					 }
						//cDefault is the function to execute with cKey is 'default'
                 },
                 'cDescription': {
                     cKey: 'cDescriptionEnabled',
                     cKeyField: view.typeinfo.cDescriptionKey,
                     cDataField: view.typeinfo.data.cDescriptionCol[0].name,
                     cTrue: function(data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,initializedCMap){
					
					 },
					 cDefault:function(data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize, initializedCMap){
					 var newField='#{cDescription}';
					 return  cTypeClassOutput['equalsToAnotherField'](data, cfieldsObjName, numCFieldObj,groupCount,cFieldsObjSize,newField, initializedCMap);
					 }
                 }
             };
			console.log("cFieldsObj",cFieldsObj);
            var propertiesArr = processCFields(data,keyLength, nameArr, opArr, idArr, cFieldsObj, initializedCMap,view);
			 console.log("propertiesArr kl",propertiesArr);
			
				
             var combineArr = [];
             propertiesArr.forEach(function(d, i) {
                 var obj = nameArr[i] + d;
                 combineArr.push(obj);
             })

             var globalArr = [];
             data.forEach(function(d, i) {
                 var localObj = _.object(combineArr, d);
                 globalArr.push(localObj);
             })
			
			 
             return globalArr;

         };

         processCFields = function(data,keyLength, nameArr, opArr, idArr, cFieldsObj, initializedCMap,view) {
             var numCFieldObj = 0;
             var cFieldClass = {};
			 var groupCount=_.size(getArr(view.typeinfo.data.keys,'name',view));
			 var cFieldsObjSize=_.size(_.keys(cFieldsObj));
			 initializedCMap['cFieldsObj']=[];
             for (var propertyName in cFieldsObj) {
                 if (cFieldsObj[propertyName]['cKeyField'] == cFieldsObj[propertyName]['cKey'] && cFieldsObj[propertyName]['cDataField'] != null) 
					{
                     cFieldClass[numCFieldObj] = '#{' + propertyName + '}';   
                     //initializing cMap if need be.
                     cFieldsObj[propertyName]['cTrue'](data, propertyName, numCFieldObj,groupCount,cFieldsObjSize, initializedCMap);
					 numCFieldObj++;
					 initializedCMap['cFieldsObj'].push(cFieldsObj[propertyName]['cType']);
                 }
				 else {
				 cFieldsObj[propertyName]['cDefault'](data, propertyName, numCFieldObj,groupCount,cFieldsObjSize, initializedCMap);
				 
				 }
             }
             function getKeyArr(nameArr,startIndex,length){
			 var rangeArr=_.range(startIndex,length+1);
				var filtered=_.filter(nameArr,function(num,i){ var o=false;
				_.each(rangeArr,function(n,m){
				if(i==n) o=true;
				}); return o;});
			return filtered;
			 }
			 function getColArr(nameArr,startIndex,length){
			 var nameArrLength=_.size(nameArr);
			 var firstIndexForCol=startIndex+length;
			 var rangeArr=_.range(firstIndexForCol,nameArrLength+1);
			 	var filtered=_.filter(nameArr,function(num,i){ var o=false;
				_.each(rangeArr,function(n,m){
				if(i==n) o=true;
				}); return o;});
			return filtered;
			 }
          //   var keyArr = _.first(nameArr, keyLength + numCFieldObj);
           //  var colArr = _.last(nameArr, nameArr.length - (keyLength + numCFieldObj));
		   var keyArr=getKeyArr(nameArr,numCFieldObj,keyLength);
		   var colArr=getColArr(nameArr,numCFieldObj,keyLength);
		   console.log("keyArr",keyArr);
		   console.log("colArr",colArr);
             var nameArr = _.map(colArr, function(num, i) {
                 return opArr[i] + "(" + num + ")";
             });
            
             var keyLArr = d3.range(0, keyLength + numCFieldObj);
             var propertiesArr = [];
			 var cFieldClassSize=_.size(_.keys(cFieldClass));
             keyLArr.forEach(function(d, i) {
                 var obj = (typeof cFieldClass[i] != 'undefined') ? cFieldClass[i] : '#{groupby' + (i + 1-cFieldClassSize) + '}';
                 propertiesArr.push(obj);
             })
			 var bracIdArr=_.map(idArr,function(m){
			 return '#['+m+']';
			 });
			propertiesArr=propertiesArr.concat(bracIdArr);

             return propertiesArr;
         };
		  cTypeClassOutput = {
                 'majority': function(data, cfieldsObjName, positionIndex,groupCount,cFieldsObjSize,newField, initializedCMap) {
                     var cMaj = [];
                     _.each(data, function(d) {
                         cMaj.push(d[positionIndex]);
                     });
                     var cUniq = _.uniq(cMaj);
                     var cToggleCount = _.countBy(cMaj, function(types) {
                         var Ttype;
                         _.each(cUniq, function(m) {
                             if (types == m) Ttype = m;
                         });
                         return Ttype;
                     });
					
                     console.info("cToggleCount Type", cToggleCount);
                     for (var propertyName in cToggleCount) {
                         initializedCMap[cfieldsObjName] = (typeof initializedCMap['cToggleType'] == 'undefined') ?
                             propertyName : (initializedCMap[cfieldsObjName][cToggleType] > initializedCMap[cfieldsObjName][propertyName]) ? initializedCMap[cfieldsObjName] : propertyName;
                     }

                 },
                 'uniqToAnotherField': function(data, cfieldsObjName, positionIndex,groupCount,cFieldsObjSize,newField, initializedCMap) {
					
					//positionIndex is the positionIndex is position of the cfield in JSON-array
					var uniqDescription=[];
					var uniqMap={};
					_.each(data,function(d,i) {//JSON with only two fields
						var pegIndex= cFieldsObjSize+groupCount-1;
						
						if(i==0) {uniqDescription.push(d[positionIndex]);			
						var pegName=d[pegIndex];
						var desName=d[positionIndex];
						uniqMap[pegName]=desName;
						}
						else if (_.size(_.intersection(uniqDescription,[d[positionIndex]]))== 0){
						uniqDescription.push(d[positionIndex]);
						var pegName=d[pegIndex];
						var desName=d[positionIndex];
						uniqMap[pegName]=desName;
						}
						});
						initializedCMap[cfieldsObjName]={};
						initializedCMap[cfieldsObjName]['lookup']='groupby'+groupCount;
						initializedCMap[cfieldsObjName]['map']=uniqMap;
						initializedCMap[cfieldsObjName]['newField']=newField;
                 },
				 'cMapNotDefined': function(data, cfieldsObjName, positionIndex,groupCount,cFieldsObjSize,newField, initializedCMap) {
				 
				 },
				 'equalsToAnotherField':function(data, cfieldsObjName, positionIndex,groupCount,cFieldsObjSize,newField, initializedCMap) {
				var uniqDescription=[];
					var uniqMap={};
					_.each(data,function(d,i) {//JSON with only two fields
						var pegIndex= groupCount-1;
						
						if(i==0) {uniqDescription.push(d[positionIndex]);			
						var pegName=d[pegIndex];
						var desName=d[pegIndex];
						uniqMap[pegName]=desName;
						}
						else if (_.size(_.intersection(uniqDescription,[d[positionIndex]]))== 0){
						uniqDescription.push(d[positionIndex]);
						var pegName=d[pegIndex];
						var desName=d[pegIndex];
						uniqMap[pegName]=desName;
						}
						});
						initializedCMap[cfieldsObjName]={};
						initializedCMap[cfieldsObjName]['lookup']='groupby'+groupCount;
						initializedCMap[cfieldsObjName]['map']=uniqMap;
						initializedCMap[cfieldsObjName]['newField']=newField;
				 },
             };
         hexToModel1 = function(data, legendKey, formatLegendCast, view) {
             var ReadArray, columnNameArray, model_keyArray, objKey;
             ReadArray = [];

             objKey = Object.keys(data[0]);
			 console.log("objKey kl",objKey);
			 console.log("data kl",data[0]);
             model_keyArray = [];
             columnNameArray = [];
             var keyArray = [];
             //legendFormating
             var formatLegend; //formatLegend should be a class containing the Legend format for each model 
             if (formatLegendCast === "" && legendKey === "formatLegend")
                 console.info("Enter formatLegend");
             if (legendKey === "formatLegend") {
                 console.info("proceed");
                 eval(formatLegendCast);
             }
             if (view.typeinfo.data.operable.values[0].id === "columnInducedGroupby.L1" && formatLegendCast === "") {

                 formatLegend = {
                     'columnInducedGroupby.L1': function(dataZero) {
                         return dataZero.columnNameWithoutOp;
                     }
                 };
             }

             //-end legendFormating
             objKey.forEach(function(key) {
                 var columnNameObj, model_keyObj;
                 if ((key.contains("|") == false) && (key.contains("#{") == false)) {
                     keyArray.push(key);
                 } else {
                     return;
                 }


             });
             console.log("inside keyArray", JSON.stringify(keyArray));
             data.forEach(function(d, i) {
                 var Category, ColumnName, GroupNameArr, Model, ReadObj, Value, lastGroupby, propertyName,Description;
                 ReadObj = {};
                 Value = void 0;
                 ColumnName = void 0;
                 Category = void 0;
                 Model = void 0;
                 lastGroupby = void 0;
				 Description= void 0;
                 GroupNameArr = [];
                 for (propertyName in d) {
                     if (propertyName.contains("xaxis") === true) {
                         Category = d[propertyName];
                     }
                     if (propertyName.contains("groupby") === true) {
                         lastGroupby = d[propertyName];
                         GroupNameArr.push(lastGroupby);
                     }
					      if (propertyName.contains("Description") === true) {
                         Description = d[propertyName];
                     }
                 }
                 var dataZero = [];
                 keyArray.forEach(function(modelKey, n) {
                     var allGroupby, lastGroupby_op, model_keyObj, model_keyObjArr, model_yAxisObj, objPush;
                     for (propertyName in d) {
                         if (propertyName.contains(modelKey) === true) {
                             model_keyObj = propertyName.replace(/.*\[|\]/g, "");
                             model_keyObjArr = model_keyObj.split(".");
                             model_yAxisObj = (model_keyObjArr.length > 1 ? model_keyObjArr[1] : "1");
                             //-end
                             objPush = {
                                 model: model_keyObjArr[0],
                                 yAxis: model_yAxisObj,                                                    
                                 value: d[propertyName],
                                 category: Category,
								 description: Description
                             };
                             GroupNameArr.forEach(function(d, m) {
                                 propertyName = "groupby" + (m + 1);
                                 objPush[propertyName] = d;
                             });
                             if (legendKey === "lastGroupby_op") {
                                 lastGroupby_op = lastGroupby;
                                 objPush["legendKey"] = lastGroupby_op;
                                 ReadArray.push(objPush);
                             } else if (legendKey === "allGroupby") {
                                 allGroupby = GroupNameArr.join("_");
                                 objPush["legendKey"] = allGroupby;
                                 ReadArray.push(objPush);
                             } else if (legendKey == "op(ColumnName)") {
                                 objPush["legendKey"] = cName;
                                 ReadArray.push(objPush);
                             } else if (legendKey == "formatLegend") {
                                 if (i == 0) console.log("objPush for Legend", JSON.stringify(objPush));
                                 objPush["legendKey"] = formatLegend[model_keyObj](objPush);
                                 ReadArray.push(objPush);
                             } else if (legendKey == "ColumnName") {
                                 var regExp = /\(([^)]+)\)/;
                                 var matches = regExp.exec(cName);
                                 objPush["legendKey"] = matches[1];
                                 ReadArray.push(objPush);
                             }
                         }
                     }
                 });
             });
             return ReadArray;
         };
         modelAddCMap=function(modelData,initializedCMap){
			var result=modelData;
		
		 for (var propertyName in initializedCMap){
		  if(typeof initializedCMap[propertyName]['lookup'] !='undefined') {
		  		var lookUpProperty;
				_.each(Object.keys(modelData[0]),function(m,n){
					if (_.str.include(m,initializedCMap[propertyName]['lookup']))
				lookUpProperty=m;
				});
				result=_.map(result,function(d,i){
			var sampleObj=_.clone(d);
			var newFieldValue=initializedCMap[propertyName]['map'][d[lookUpProperty]];
			var newFieldName=initializedCMap[propertyName]['newField'];
			sampleObj[newFieldName]=newFieldValue;
			return sampleObj;
			});
			}
		 }
		 return result;
		 };
		 modelToHex = function(modelData, groupByArr) {
             var hexData = [];
             var nest = d3.nest();
             _.each(groupByArr, function(m, n) {
                 nest=nest.key(function(d) {
                     return d[m];
                 });
             });
             nest.rollup(function(d) {
                 var uniqModel = _.uniq(_.pluck(d, 'model'));
                 var sampleObj = _.clone(d[0]);
                 _.each(uniqModel, function(m) {
                     sampleObj[m] = _.pluck(_.where(d, {
                         'model': m
                     }), 'value')[0];
                 });
                 //remove fields that won't be needed
                 _.each(['yAxis', 'value', 'model','category'], function(n) {
                     delete sampleObj[n];
                 });
                 hexData.push(sampleObj);
             });
			 nest.entries(modelData);
             return hexData;
         };
         //--Enhanced Logic for UI to make chart smarter
         autoDetectNestArr = function(f, view) {
             var nameArr = getArr(f.operable.values, 'name', view);
             nameArr = _.map(nameArr, function(d) {
                 return (_.str.include(d, '.')) ? d.split('.')[1] : d;
             });
             return nameArr;
         };
         //--End,Enhanced Logic for UI to make chart smarter
         groupByFn = function(data, groupByArr) {
             var aggreData, nest;
             nest = d3.nest();
             aggreData = [];
             _.each(groupByArr, function(m, n) {
                 nest.key(function(d) {
                     return d[m];
                 });
             });
             var result = [];
			nest.rollup(function(k) {
                 var sampleObj = _.clone(k[0]);
       sampleObj['value'] = d3.sum(k, function(g) {
                     return g.value;
                 });
          
                 result.push(sampleObj);
             }).entries(data);
             return result;
         };
         //$$$
            chartPreGen = function(modelData,rootObj,Fselect) {
             //clear the UI and chart
          //   $('#body_preview').empty();
/*
             for (var property in modelData[0]) {
                 if (_.str.include(property, 'groupby')) groupCount++;
             }
			 */
			 groupCount=2;
             groupbyRange = _.map(_.range(1, groupCount + 1), function(m) {
                 return 'groupby' + m;
             });
             var groupByArr = ['model'];
             var groupByArr = _.union(groupByArr, groupbyRange);

             var aggregateData = groupByFn(modelData, groupByArr);
             var modelToHexData = modelToHex(aggregateData, groupbyRange);
			 console.log("modelToHexData",JSON.stringify(modelToHexData));
             var nest=d3.nest();
             _.each(groupbyRange, function(m, n) {
                 nest=nest.key(function(d, i) {
                     return d[m];
                 });
             });
			
             rootObj['values'] = nest.entries(modelToHexData);

             color= ["#bd0026", "#fecc5c", "#fd8d3c", "#f03b20", "#B02D5D",
                 "#9B2C67", "#982B9A", "#692DA7", "#5725AA", "#4823AF",
                 "#d7b5d8", "#dd1c77", "#5A0C7A", "#5A0C7A"
             ];

             rootObj['x0'] = (height) / 2;
            rootObj['y0'] = 0;
			
			Fselect.sourceField=_.union(['description'],groupbyRange);
    

         };
         initializeToolTip = function(f, view, nestArr, groupCount,Fselect,ToolTipContainer,cFieldsObj,modelYAxisObj) {
            var modelYAxisMap = getArr(f.operable, 'id', view);
       
		
			_.each(modelYAxisMap,function(d){
				var propertyName=d.split(".")[0];
				modelYAxisObj[propertyName]=d.split(".")[1];
				
			});
	
			console.log('modelYAxisMap kop',modelYAxisMap);
			_.each(modelYAxisMap,function(j,k){
					     var propertyName=k+1;
                         ToolTipContainer[propertyName]=j.split(".")[0];
                         
				});
             _.each(_.values(ToolTipContainer), function(d, i) {
                 var toolTipSel = d3.select('#toolTip_preview #toolAppend').append("div").attr("id", 'toolDiv_preview_' + (i + 1))
                     .style({
                         'width': '135px',
                         'left': '0px',
                         'top': '10px',
                         'position': 'absolute'
                     });
                 if (i == 0) toolTipSel.attr("class", 'selected');
                 toolTipSel.append("div").attr("class", "header3").html("<br>"+d);
                 toolTipSel.append("div").attr("class", "header-rule");
                 toolTipSel.append("div").attr("id", 'toolSpend_preview_' + (i + 1)).attr("class", "header4");

             });

             //Add window Fselect object to source Field in the js file
             var fSelectNameArr = _.map(_.values(ToolTipContainer), function(d) {
                 return 'sum_' + d;
             }); // add 'sum_' infront
			 
             Fselect['spendField'] = fSelectNameArr[0];
             Fselect['actField'] = fSelectNameArr[0];
             Fselect['sumField'] = _.values(ToolTipContainer);

         };
		safeRead = function() {
			var current, formatProperty, obj, prop, props, val, _i, _len;

			obj = arguments[0], props = 2 <= arguments.length ? [].slice.call(arguments, 1) : [];

			read = function(obj, prop) {
				if ((obj != null ? obj[prop] : void 0) == null) {
					return;
				}
				return obj[prop];
			};

			current = obj;
			for (_i = 0, _len = props.length; _i < _len; _i++) {
				prop = props[_i];

				if (val = read(current, prop)) {
					current = val;
				} else {
					return undefined;
				}
			}
			return current;
		};
  
   getArr =function(obj, k, view) { //used on view.typeinfo to get an array of property value of the propertyName 'name'
     var objects = [];
     for (var i in obj) {
         if (!obj.hasOwnProperty(i)) continue;
         if (typeof obj[i] == 'object') {

             objects = objects.concat(getArr(obj[i], k, view));
			
         } else if (i.contains(k) == true) {
		
             if (k == "name") {
                 objects.push(cutTableName(obj[i], view));
             } else
                 objects.push(obj[i]);
         }
     }
	
     return objects;
 };
    cutTableName=function(stringText,view) {
		
      var uniTable = (view.data.jsonClass === "DataAdhocTable") ? view.data.fields[0].table + "." : null;
      var colm = (uniTable == null) ? stringText : stringText.split(uniTable)[1];
      return colm;
  };


     }

</script>
</html>
